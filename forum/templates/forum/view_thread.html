<!-- forum/templates/forum/view_thread.html -->

{% extends 'base.html' %}

{% block content %}
    <h1>{{ thread.title }}</h1>

    <p>{{ thread.content }}</p>
    <p>Posted by {{ thread.author }} on {{ thread.created_at }}</p>

    <!-- List of responses -->
    <div class="response-list">
        {% for response in thread.response_set.all %}
            <div class="response">
                <p>{{ response.content }}</p>
                <p>Posted by {{ response.author }} on {{ response.created_at }}</p>
                
                <!-- Upvote and downvote buttons -->
                <button class="upvote-btn{% if request.user.is_authenticated and request.user in response.upvoted_by.all %} voted{% endif %}" data-response-id="{{ response.id }}" data-vote-type="upvote">Upvote ({{ response.upvotes }})</button>
                <button class="downvote-btn{% if request.user.is_authenticated and request.user in response.downvoted_by.all %} voted{% endif %}" data-response-id="{{ response.id }}" data-vote-type="downvote">Downvote ({{ response.downvotes }})</button>
            </div>
        {% endfor %}
    </div>

    <!-- Form to post a response -->
    {% if user.is_authenticated %}
        <h2>Post a Response</h2>
        <form method="post" action="{% url 'forum:create_response' thread.id %}">
            {% csrf_token %}
            {{ response_form.as_p }}
            <button type="submit">Post Response</button>
        </form>
    {% else %}
        <p><a href="{% url 'login' %}">Log in</a> to post a response.</p>
    {% endif %}
    
    <a href="{% url 'forum:thread_list' %}">Back to Thread List</a>
</div>
{% endblock %}
